#!/usr/bin/env nu

def main [] {
	hyprctl activewindow -j | jq -rc

	socat -u $"UNIX:/tmp/hypr/($env.HYPRLAND_INSTANCE_SIGNATURE)/.socket2.sock" - | lines -s | each {|line|
		let event = $line | parse "{type}>>{data}" | first

		match $event.type {
			activewindowv2 => {
				let query = $event.data
					| prepend `.[] | select(.address == "0x`
					| append `")`
					| str join
				hyprctl clients -j | jq -rc $query
			},
		}
	}
}
