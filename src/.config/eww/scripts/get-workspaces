#!/usr/bin/env nu

def query [] {
	hyprctl workspaces -j | jq -rc
}

def main [] {
	query

	socat -u $"UNIX:/tmp/hypr/($env.HYPRLAND_INSTANCE_SIGNATURE)/.socket2.sock" - | lines -s | each {|line|
		let event = $line | parse "{type}>>{data}" | first

		if $event.type not-in [workspace createworkspace destroyworkspace] { continue }

		query
	}
}
